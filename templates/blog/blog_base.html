{% extends 'layout/base.html' %}
{% load static %}
{% load blog_filter %}

{% block meta %}
<link href="{% static 'css/blog.css' %}" rel="stylesheet">
<script>
    console.log('blog_base');
</script>
{% endblock %}

{% block content %}
<main class="container-xxl bbb">
    <div class="row">
        <aside class="sisu-aside col-12 col-lg aaa no-padding">
            <div class="prifile d-none d-lg-block bbb">
                {% getProfile as profile %}
                <div class="aaa">
                    <img src="{{profile.image.url}}" alt="í”„ë¡œí•„ ì‚¬ì§„" style="width:100%; border-radius: 50%;" onerror="src='/static/images/profile_404.png'">
                </div>
                <div class="aaa">
                    {{profile.nickname}}
                </div>
                <div class="aaa">
                    {{profile.desc|linebreaksbr}}
                </div>
            </div>
            <div class="large-sticky bbb">
                <div class="mobile-wrapper aaa">
                    {% if user.is_authenticated %}
                    <div class="bbb">
                        <a href="{% url 'blog:create_post' %}">create</a>
                    </div>
                    {% endif %}
                    <div class="bbb">
                        <button type="button" id="search-modal-button">ê²€ìƒ‰</button>
                    </div>
                    <div class="d-lg-none bbb">
                        <button type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
                            ë©”ë‰´ ì—´ê¸°
                        </button>
                    </div>
                </div>
                <div class="offcanvas-lg offcanvas-start aaa" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
                    <div class="d-lg-none bbb">
                        <h5 id="offcanvasExampleLabel">ë¸”ë¡œê·¸ ë©”ë‰´ ëª©ë¡</h5>
                        <button type="button" data-bs-dismiss="offcanvas" data-bs-target="#offcanvasExample" aria-label="Close">ë‹«ê¸°</button>
                    </div>
                    <div class="bbb" style="overflow-y: auto;">
                        <ul class="aaa">
                            <li><a href="{% url 'blog:post_list' 'all' %}">ì „ì²´ë³´ê¸°ğŸ”®</a></li>
                            {% getTree as menus %}
                            {% for node in menus %} 
                                {% include 'blog/tree.html' %}
                            {% endfor %}
                            <li><a href="{% url 'blog:post_list' 'None' %}">ê³ ì•„ë“¤ğŸ˜¢</a></li>
                        </ul>
                    </div>
                </div>
                {% comment %} //ìˆ˜ì • ê°œë°œ í•  ê²ƒë“¤ {% endcomment %}
                <div class="current d-none d-lg-block aaa">
                    <div class="bbb">
                        <span>ìµœê·¼ ì‘ì„± ê¸€</span>
                        {% getRecentPost as rc_post %}
                        {% if rc_post %}
                        <div class="aaa">
                            <a href="{% url 'blog:get_post' rc_post.id %}"><span class="small-span">{{rc_post.title}}</span></a>
                        </div>
                        {% else %}
                        <div class="aaa">
                            <span class="small-span">ê¸€ì´ ì—†ì–´ìš”..</span>
                        </div>
                        {% endif %}
                    </div>
                    <div class="bbb">
                        ìµœê·¼ ë‹¬ë¦° ëŒ“ê¸€
                        {% getRecentComment as rc_cmt %}
                        {% for cmt in rc_cmt %}
                        <div class="aaa">
                            <a href="{% url 'blog:get_post' cmt.post_id %}#comment-wrapper"><span class="small-span">{{cmt.content}}</span></a>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="bbb">
                        <span>ìµœê·¼ ë³¸ ì˜í™”</span>
                        {% getRecentMovie as rc_movie %}
                        {% if rc_movie %}
                        <a href="{% url 'movie:index' %}#{{rc_movie.id}}">
                            <div class="movie-box">
                                <img src="{{rc_movie.thumbnail.url}}" class="movie" alt="{{rc_movoie.title}}" onerror="src='/static/images/movie_404.png'">
                            </div>
                        </a>
                        {% else %}
                        ì˜í™”ê°€ ì—†ì–´ìš”..
                        {% endif %}
                    </div>
                </div>
            </div>
        </aside>
        <div class="col-12 col-lg-10 aaa no-padding">
            {% include template %}
        </div>
    </div>
</main>
<!-- ê²€ìƒ‰ ëª¨ë‹¬ -->
<div class="modal modal-sm fade" id="searchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div>
                    ë¸”ë¡œê·¸ ê²€ìƒ‰
                    <button type="button" data-bs-dismiss="modal" aria-label="Close">ë‹«ê¸°</button>
                </div>
                <div>
                    <form method="GET" action="{% url 'blog:post_list' 'search' %}">
                        <select name="kt">
                            <option value="search_title_content" selected>ì œëª©+ë‚´ìš©</option>
                            <option value="search_title">ì œëª©</option>
                            <option value="search_content">ë‚´ìš©</option>
                        </select>
                        <input type="text" name="kw" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.">
                        <button type="submit">ê²€ìƒ‰</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const SEARCH_MODAL = new bootstrap.Modal(document.getElementById("searchModal"));
    document.getElementById("search-modal-button").addEventListener("click", () => {
        SEARCH_MODAL.show();
    })
</script>
{% endblock %}